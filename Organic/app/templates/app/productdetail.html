{% extends "app/base.html" %}
{% load static %}

{% block title %}GreenNest â€“ Organic Market{% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'app/css/detail.css' %}">
  <!-- Product Detail -->
  <section class="container detail-wrapper">
    <div class="detail-img">
      <!-- Main Images -->
      <div class="slider">
        {% if product.images.all %}
          {% for img in product.images.all %}
            <div class="slide {% if forloop.first %}active{% endif %}">
              <img src="{{ img.image.url }}" alt="{{ product.name }}">
            </div>
          {% endfor %}
        {% else %}
          <div class="slide active">
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
          </div>
        {% endif %}
      </div>

      <!-- thumbnail -->
      <div class="thumbnails thumbnails-bottom">
        {% for img in product.images.all %}
          <img src="{{ img.image.url }}" 
              data-index="{{ forloop.counter0 }}" 
              class="thumb {% if forloop.first %}active{% endif %}">
        {% endfor %}
      </div>
    </div>
  
    </div>
    <div class="detail-info">
      <h1>{{ product.name }}</h1>
      <div class="price">
        {% if product.sale %}
          <strong style="font-size:24px; color:var(--green);">${{ product.final_price|floatformat:2 }}</strong>
          <span style="text-decoration:line-through; color:gray; font-size:16px;">${{ product.price|floatformat:2 }}</span>
        {% else %}
          <strong style="font-size:24px; color:var(--green);">${{ product.price }}</strong>
        {% endif %}
      </div>
      <div class="tabs">
        <button class="tab-btn active" data-tab="desc">Description</button>
        <button class="tab-btn" data-tab="nutrition">Nutrition</button>
      </div>

      <div class="tab-content active" id="desc">
        <p>{{ product.description }}</p>
      <form method="post" action="{% url 'add_to_cart' product.id %}" class="add-to-cart-form" style="margin-top:16px;">
        {% csrf_token %}
        <div class="add" style="align-items:center; gap:12px;">
          <div class="add">
                <div class="qty">
                  <button type="button" class="qty-decrease">âˆ’</button>
                  <span class="qty-display">1</span>
                  <button type="button" class="qty-increase">+</button>
                </div>
          <input type="hidden" name="quantity" value="1" class="qty-input">
          <button type="submit" class="btn-primary" style="padding:14px 18px">ðŸ›’ Add to cart</button>
          </div>
      </form>
    </div>
      </div>

      <div class="tab-content" id="nutrition">
        {% if product.nutrition %}
          <table class="nutrition-table">
            <tr><td>Calo</td><td>{{ product.nutrition.calories }} kcal</td></tr>
            <tr><td>Protein</td><td>{{ product.nutrition.protein }} g</td></tr>
            <tr><td>Fat</td><td>{{ product.nutrition.fat }} g</td></tr>
            <tr><td>Carbohydrate</td><td>{{ product.nutrition.carbs }} g</td></tr>
            <tr><td>Fiber</td><td>{{ product.nutrition.fiber }} g</td></tr>
            <tr><td>Sugar</td><td>{{ product.nutrition.sugar }} g</td></tr>
            <tr><td>Natri</td><td>{{ product.nutrition.sodium }} mg</td></tr>
          </table>
        {% else %}
          <p class="subtle">There is no nutritional information for this product..</p>
        {% endif %}
      </div>


      
  </section>

  <!-- Related Products -->
  <section class="container related">
  <h2>Related products</h2>
  <div class="grid">
    {% for rp in related_products %}
      <article class="card">
        <a href="{% url 'productdetail' rp.id %}" style="text-decoration:none; color:inherit;">
          <div class="thumb">
            {% if rp.image %}
              <img src="{{ rp.image.url }}" alt="{{ rp.name }}" style="width:100%; height:180px; object-fit:cover;">
            {% else %}
              <div class="seed"></div>
            {% endif %}
          </div>
          <div class="content">
            {% for cert in rp.certifications.all %}
              <div class="pill"
                style="background: {{ cert.style_colors.bg }};
                       color: {{ cert.style_colors.text }};
                       border: 1px solid {{ cert.style_colors.border }}">
                â€¢ {{ cert.name }}
              </div>
            {% endfor %}

            <h3 style="margin:8px 0 6px">{{ rp.name }}</h3>
            <p class="subtle">{{ rp.description|truncatewords:12 }}</p>
          </div>
        </a>
      </article>
    {% empty %}
      <p class="subtle">No related products.</p>
    {% endfor %}
  </div>
</section>


  <script src="{% static 'app/js/home.js' %}"></script>
  <script src="{% static 'app/js/detail.js' %}"></script>
  


{% endblock %}
