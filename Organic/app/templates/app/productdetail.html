{% extends "app/base.html" %}
{% load static %}

{% block title %}{{ product.name }} – GreenNest{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="https://cdn.lineicons.com/4.0/lineicons.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
<link rel="stylesheet" href="{% static 'app/css/productdetail.css' %}"> 
<link rel="stylesheet" href="{% static 'app/css/product_card.css' %}"> 
<link rel="stylesheet" href="{% static 'app/css/neo-brutalism-global.css' %}"> 


<main class="container detail-wrapper"> 
<!-- Breadcrumb --> 
  <div class="breadcrumb-container">  
    <div class="breadcrumb"> 
      <a href="{% url 'home' %}">Home</a> > 
        <a href="{% url 'productlist' %}">Products</a> > 
        <span>{{ product.name }}</span> </div> 
      </div> 
<!-- Product Detail -->
<section class="product-detail-container">
<!-- Images -->
<div class="product-images">
  {% if product.images.all %}
    <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="main-image">
    <div class="thumbnail-container">
      {% for img in product.images.all %}
        <img src="{{ img.image.url }}" alt="{{ product.name }}" class="thumbnail {% if forloop.first %}active{% endif %}">
      {% endfor %}
    </div>
  {% else %}
    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="main-image">
  {% endif %}
</div>

<!-- Info -->
<div class="product-info">
  {% if product.certifications.all %}
    <div class="product-tags">
      {% for cert in product.certifications.all %}
        <span class="tag">{{ cert.name }}</span>
      {% endfor %}
    </div>
  {% endif %}

  <h1 class="product-title">{{ product.name }}</h1>

  <div class="product-price">
    {% if product.sale %}
      <strong style="color:var(--green)">${{ product.final_price|floatformat:2 }}</strong>
      <span style="text-decoration:line-through; color:gray">${{ product.price|floatformat:2 }}</span>
    {% else %}
      <strong style="color:var(--green)">${{ product.price|floatformat:2 }}</strong>
    {% endif %}
  </div>

  <p class="product-description">{{ product.description }}</p>

  <!-- Nutrition Highlights -->
                <div class="nutrition-highlights">
                    <h3>Nutrition Highlights</h3>
                    <div class="nutrition-icons">
                        <div class="nutrition-item">
                            <i class="fas fa-seedling"></i>
                            <span>High Protein</span>
                        </div>
                        <div class="nutrition-item">
                            <i class="fas fa-heart"></i>
                            <span>Heart Healthy</span>
                        </div>
                        <div class="nutrition-item">
                            <i class="fas fa-carrot"></i>
                            <span>High Fiber</span>
                        </div>
                    </div>
                </div>

  <!-- Nutrition highlights (optional short display) -->
  {% if product.nutrition %}
  <div class="nutrition-highlights">
    <h3>Nutrition Highlights</h3>
    <div class="nutrition-icons">
      {% if product.nutrition.protein %}
      <div class="nutrition-item">
        <i class="fas fa-seedling"></i>
        <span>{{ product.nutrition.protein }}g Protein</span>
      </div>
      {% endif %}
      {% if product.nutrition.fiber %}
      <div class="nutrition-item">
        <i class="fas fa-carrot"></i>
        <span>{{ product.nutrition.fiber }}g Fiber</span>
      </div>
      {% endif %}
      {% if product.nutrition.fat %}
      <div class="nutrition-item">
        <i class="fas fa-heart"></i>
        <span>{{ product.nutrition.fat }}g Fat</span>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Add to cart -->
  <div class="product-actions">
    <form method="post" action="{% url 'add_to_cart' product.id %}" class="add-to-cart-form">
      {% csrf_token %}
      <br>
      <button type="submit" class="add-to-cart">Add to Cart</button>
    </form>
  </div>
</div>
</section> 
<!-- Tabs --> 
<section class="product-details"> 
 <div class="tabs"> 
  <div class="tab active" data-tab="description">Description</div> 
   <div class="tab" data-tab="nutrition">Nutrition Facts</div> 
  </div>
<!-- Description -->
 <div class="tab-content active" id="description">
   <p>{{ product.description }}</p>
 </div>

<!-- Nutrition -->
<div class="tab-content" id="nutrition">
  {% if product.nutrition %}
  <div class="nutrition-table">
                        <div class="nutrition-row heading">
                            <span>Amount Per Serving</span>
                        </div>
                        <div class="nutrition-row">
                            <span>Calories</span>
                            <span><strong>{{ product.nutrition.calories }} kcal</strong></span>
                        </div>
                        <div class="nutrition-row heading">
                            <span>% Daily Value*</span>
                        </div>
                        <div class="nutrition-row">
                            <span>Protein</span>
                            <span>{{ product.nutrition.protein }} g</span>
                        </div>
                        <div class="nutrition-row sub">
                            <span>Fat</span>
                            <span>{{ product.nutrition.fat }} g</span>
                        </div>
                        <div class="nutrition-row sub">
                            <span>Carbohydrates</span>
                            <span>{{ product.nutrition.carbs }} g</span>
                        </div>
                        <div class="nutrition-row">
                            <span>Fiber</span>
                            <span>{{ product.nutrition.fiber }} g</span>
                        </div>
                        <div class="nutrition-row">
                            <span>Sugar</span>
                            <span>{{ product.nutrition.sugar }} g</span>
                        </div>
                        <div class="nutrition-row">
                            <span>Sodium</span>
                            <span>{{ product.nutrition.sodium }} mg</span>
                        </div>
                      </div>
  {% else %}
  <p class="subtle">No nutrition information available.</p>
  {% endif %}
</div>
</section> 
<!-- Related Products --> 
<section class="related-products"> 
  <h2 class="related-title">You Might Also Like</h2> 
  <div class="related-grid"> {% for rp in related_products %} 
    <div class="product-card"> 
      <a href="{% url 'productdetail' rp.id %}"> 
        <div class="card-image"> {% if rp.image %} 
        <img src="{{ rp.image.url }}" alt="{{ rp.name }}" class="product-img primary"> 
        {% endif %} 
      </div> 
      <div class="card-info"> 
        <h3 class="product-name">{{ rp.name }}</h3> 
          <p class="subtle">{{ rp.description|truncatewords:12 }}</p> 
            <button class="btn-add-cart"> 
              <span class="btn-text">Add</span> 
                <span class="btn-price">${{ rp.price|floatformat:2 }}</span> 
            </button> 
          </div>
        </a> 
      </div> 
      {% empty %} 
      <p class="subtle">No related products available.</p> 
      {% endfor %} 
    </div> 
  </section> 
</main> 
<script src="{% static 'app/js/productdetail.js' %}"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    const tabs = document.querySelectorAll(".tab");
    const contents = document.querySelectorAll(".tab-content");

    tabs.forEach(tab => {
        tab.addEventListener("click", () => {
            // Bỏ active ở tất cả tab và nội dung
            tabs.forEach(t => t.classList.remove("active"));
            contents.forEach(c => c.classList.remove("active"));

            // Gắn lại active cho tab được click và nội dung tương ứng
            tab.classList.add("active");
            document.getElementById(tab.dataset.tab).classList.add("active");
        });
    });
});
</script>

{% endblock %}