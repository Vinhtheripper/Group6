{% extends "app/base.html" %}
{% load static %}
{% block title %}GreenNest â€“ Checkout{% endblock %}
{% block content %}

<link rel="stylesheet" href="{% static 'app/css/checkout.css' %}"> 
<link rel="stylesheet" href="{% static 'app/css/neo_brutalism_global.css' %}"> 
<style>
  .container{
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 60px;
  }
  .payment-option {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
  cursor: pointer;
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 10px;
  transition: all 0.25s ease;
}

.payment-option:hover {
  background-color: #f9f9f9;
}

.payment-option input[type="radio"] {
  transform: scale(1.2);
}


.payment-option input[type="radio"]:checked + .payment-logo,
.payment-option input[type="radio"]:checked ~ span,
.payment-option input[type="radio"]:checked ~ img,
.payment-option input[type="radio"]:checked {
  
}

.payment-option:has(input[type="radio"]:checked) {
  background-color: #ffeb3b;
  
  
}

.payment-logo {
  width: 40px;
  height: 40px;
  object-fit: contain;
}


</style>
<!-- HERO -->

<section class="checkout-hero">
  <div class="container">
    <div class="hero-content">
      <div class="badge-organic">ðŸ”’ Secure Checkout</div>
      <h1 class="hero-title">Complete Your Order</h1>
      <p class="hero-subtitle">Just a few more steps to get your fresh organic products!</p>
    </div>
  </div>
</section>


<main class="container">
<!-- MAIN CHECKOUT GRID -->
<section class="checkout-main-section">
  <div class="container">
    <div class="checkout-grid">

      <!-- LEFT COLUMN -->
      <div class="checkout-form-wrapper">
        <form method="post" action="{% url 'checkout' %}">
          {% csrf_token %}
          
          <!-- Contact Information -->
          <div class="checkout-section">
            <h2 class="section-title">
              <span class="section-number">1</span> Contact Information
            </h2>
            <div class="form-group">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-input" name="full_name" placeholder="Nguyen Van A" value="{{ full_name|default_if_none:'' }}" required>
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" name="email" placeholder="email@example.com" value="{{ email|default_if_none:'' }}" required>
            </div>
            <div class="form-group">
              <label class="form-label">Phone Number</label>
              <input type="tel" class="form-input" name="phone" placeholder="+84 xxx xxx xxx" value="{{ phone|default_if_none:'' }}" required>
            </div>
          </div>
          <br>

          <!-- Delivery Address -->
          <div class="checkout-section">
            <h2 class="section-title">
              <span class="section-number">2</span> Delivery Address
            </h2>
            <div class="form-group">
              <label>Address</label>
              <input type="text" name="address" class="form-input" placeholder="123 Green Street" required>
            </div>
            <div class="form-group">
              <label>Note (optional)</label>
              <textarea name="note" rows="3" class="form-input" placeholder="e.g. deliver during business hours..."></textarea>
            </div>
          </div>
          <br>

          <!-- Payment Method -->
          <div class="checkout-section">
            <h2 class="section-title">
              <span class="section-number">3</span> Payment Method
            </h2>

            <label class="payment-option">
              <input type="radio" name="payment" value="cod" checked>
              <img src="{% static 'app/images/cod_ic.png' %}" alt="Cash on Delivery" class="payment-logo">
              <span>Cash on Delivery (COD)</span>
            </label>

            <label class="payment-option">
              <input type="radio" name="payment" value="momo">
              <img src="{% static 'app/images/momo_ic.png' %}" alt="MoMo" class="payment-logo">
              <span>MoMo</span>
            </label>

            <label class="payment-option">
              <input type="radio" name="payment" value="vnpay">
              <img src="{% static 'app/images/vnpay_ic.png' %}" alt="VNPay" class="payment-logo">
              <span>VNPay</span>
            </label>

            <label class="payment-option">
              <input type="radio" name="payment" value="bank">
              <img src="{% static 'app/images/banking_ic.png' %}" alt="Bank Transfer" class="payment-logo">
              <span>Bank Transfer</span>
            </label>
          </div>


          <button type="submit" class="btn btn-primary btn-checkout" name="placeorder" value="1">
            <span>Complete Order</span>
            <i class="lni lni-lock"></i>
          </button>

          <div class="legal-notice">
            <p>By completing this order, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.</p>
          </div>
        </form>
      </div>

      <!-- RIGHT COLUMN -->
      <div class="order-summary-sidebar">
        <div class="summary-card">
          <div class="summary-header">
            <h2 class="summary-title">Order Summary</h2>
            <span class="item-count-badge">{{ cart.items.count }} items</span>
          </div>

          <!-- Product List -->
          <div class="summary-product-list">
            {% for item in cart.items.all %}
              <div class="summary-product-item">
                <div class="product-image-wrapper">
                  {% if item.product %}
                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" >
              {% elif item.combo %}
                <img src="{{ item.combo.image.url }}" alt="{{ item.combo.name }}" >
              {% endif %}
                  <span class="quantity-badge">{{ item.quantity }}</span>
                </div>
                <div class="product-info">
                  {% if item.product %}
                  <h4 class="product-name">{{ item.product.name }}</h4>
                  <p class="product-desc">{{ item.product.price }}</p>
                  {% elif item.combo %}
                  <h4 class="product-name">{{ item.combo.name }}</h4>
                  <p class="product-desc">{{ item.combo.final_price|floatformat:2 }}</p>
                  {% endif %}
                </div>
                <div class="product-price">
                  <span class="final-price">${{ item.subtotal|floatformat:2 }}</span>
                </div>
              </div>
            {% empty %}
              <p>Your cart is empty.</p>
            {% endfor %}
          </div>

          <!-- Coupon -->
          <div class="discount-code-section">
            <form method="post">
              {% csrf_token %}
              <div class="discount-input-group">
                <input type="text" name="coupon" class="form-input" placeholder="Discount code" value="{{ coupon_code }}">
                <button type="submit" name="applycoupon" class="btn-apply">Apply</button>
              </div>
            </form>
          </div>

          <!-- Totals -->
          <div class="summary-totals">
            <div class="summary-row"><span>Subtotal</span><span>${{ cart.subtotal|floatformat:2 }}</span></div>
            {% if discount %}
              <div class="summary-row discount-row"><span>Discount</span><span>-${{ discount|floatformat:2 }}</span></div>
            {% endif %}
            <div class="summary-total"><span>Total</span><span>${{ total_after_discount|floatformat:2 }}</span></div>
          </div>

          <div class="trust-badges">
            <div class="trust-badge"><i class="lni lni-lock"></i> Secure Payment</div>
            <div class="trust-badge"><i class="lni lni-delivery"></i> Fast Delivery</div>
            <div class="trust-badge"><i class="lni lni-certificate"></i> Quality Guarantee</div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>
</div>
</main>
<script src="{% static 'app/js/checkout.js' %}"></script>
{% endblock %}
