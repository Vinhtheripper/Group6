{% extends "app/base.html" %}
{% load static %}
{% block title %}GreenNest ‚Äì Thanh to√°n{% endblock %}
{% block content %}

<form method="post" action="{% url 'checkout' %}">
  {% csrf_token %}
  <section class="container checkout-wrapper">

    <!-- ========== TH√îNG TIN GIAO H√ÄNG ========== -->
    <div class="checkout-card">
      <h3>Th√¥ng tin giao h√†ng</h3>

      <div class="form-row">
        <div class="form-group">
          <label>H·ªç v√† t√™n *</label>
          <input type="text" name="full_name" placeholder="Nguy·ªÖn VƒÉn A" value="{{ full_name|default_if_none:'' }}" required>
        </div>
        <div class="form-group">
          <label>S·ªë ƒëi·ªán tho·∫°i *</label>
          <input type="tel" name="phone" placeholder="0123 456 789" value="{{ phone|default_if_none:'' }}" required>
        </div>
      </div>

      <div class="form-group">
        <label>Email *</label>
        <input type="email" name="email" placeholder="email@example.com" value="{{ email|default_if_none:'' }}">
      </div>

      <div class="form-group">
        <label>ƒê·ªãa ch·ªâ *</label>
        <input type="text" name="address" placeholder="123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM" required>
      </div>

      <div class="form-group">
        <label>Ghi ch√∫ (tu·ª≥ ch·ªçn)</label>
        <textarea name="note" rows="3" placeholder="V√≠ d·ª•: giao gi·ªù h√†nh ch√≠nh..."></textarea>
      </div>

      <h3>Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
      <label class="payment-option">
        <input type="radio" name="payment" value="cash" checked> Thanh to√°n khi nh·∫≠n h√†ng (COD)
      </label>
      <label class="payment-option">
        <input type="radio" name="payment" value="momo"> V√≠ Momo
      </label>
      <label class="payment-option">
        <input type="radio" name="payment" value="vnpay"> VnPay
      </label>
      <label class="payment-option">
        <input type="radio" name="payment" value="bank"> Chuy·ªÉn kho·∫£n ng√¢n h√†ng
      </label>
    </div>

    <!-- ========== T√ìM T·∫ÆT ƒê∆†N H√ÄNG ========== -->
    <div class="checkout-card order-summary">
      <h3>ƒê∆°n h√†ng</h3>

      {% for item in cart.items.all %}
        <div class="summary-row">
          {% if item.product %}
            <span>{{ item.product.name }} (x{{ item.quantity }})</span>
          {% elif item.combo %}
            <span>üß∫ {{ item.combo.name }} (x{{ item.quantity }})</span>
          {% endif %}
          <span>${{ item.subtotal|floatformat:2 }}</span>
        </div>
      {% empty %}
        <p>Gi·ªè h√†ng tr·ªëng</p>
      {% endfor %}


      <hr style="border:none; border-top:1px solid var(--gray); margin:14px 0;">
      <div class="summary-row">
        <span>T·∫°m t√≠nh</span>
        <span>${{ cart.subtotal|floatformat: 2 }}</span>
      </div>
      <div class="summary-row">
        <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
        <span>Mi·ªÖn ph√≠</span>
      </div>

      <!-- √î nh·∫≠p m√£ gi·∫£m gi√° -->
      <hr style="border:none; border-top:1px solid var(--gray); margin:14px 0;">
      <div style="display:flex; gap:10px;">
        <input type="text" name="coupon" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°..." 
              value="{{ coupon_code }}" style="flex:1;">
        <button type="submit" class="btn btn-outline" name="applycoupon" value="1">
          √Åp d·ª•ng
        </button>
      </div>


      {% if discount and discount > 0 %}
      <div class="summary-row" style="color:green; font-weight:600; margin-top:8px;">
        <span>Gi·∫£m gi√°</span>
        <span>-${{ discount|floatformat:2 }}</span>
      </div>
      {% endif %}

      <hr style="border:none; border-top:1px solid var(--gray); margin:14px 0;">
      <div class="summary-row">
        <strong>T·ªïng c·ªông</strong>
        <strong>${{ total_after_discount|floatformat:2 }}</strong>
      </div>

      <button type="submit" class="btn btn-primary btn-checkout" name="placeorder" value="1"
              {% if cart.items.count == 0 %}disabled style="opacity:0.6; cursor:not-allowed;"{% endif %}>
        ƒê·∫∑t h√†ng
      </button>
    </div>
  </section>
</form>

<script src="{% static 'app/js/checkout.js' %}"></script>
{% endblock %}
