{% extends "app/base.html" %}
{% load static %}
{% block title %}GreenNest – Shipping{% endblock %}
{% block content %}

<form method="post" action="{% url 'checkout' %}">
  {% csrf_token %}
  <section class="container checkout-wrapper">

    <!-- ========== Shipping Information ========== -->
    <div class="checkout-card">
      <h3>Thông tin giao hàng</h3>

      <div class="form-row">
        <div class="form-group">
          <label>Fullname *</label>
          <input type="text" name="full_name" placeholder="Nguyen Văn A" value="{{ full_name|default_if_none:'' }}" required>
        </div>
        <div class="form-group">
          <label>Phone Number *</label>
          <input type="tel" name="phone" placeholder="0123 456 789" value="{{ phone|default_if_none:'' }}" required>
        </div>
      </div>

      <div class="form-group">
        <label>Email *</label>
        <input type="email" name="email" placeholder="email@example.com" value="{{ email|default_if_none:'' }}">
      </div>

      <div class="form-group">
        <label>Address *</label>
        <input type="text" name="address" placeholder="123 Đường ABC, Quận 1, TP.HCM" required>
      </div>

      <div class="form-group">
        <label>Note (Optional)</label>
        <textarea name="note" rows="3" placeholder="Ví dụ: giao giờ hành chính..."></textarea>
      </div>

      <h3>Payment Method</h3>
      <label class="payment-option">
        <input type="radio" name="payment" value="cash" checked> Cash on Delivery (COD)
      </label>
      <label class="payment-option">
        <input type="radio" name="payment" value="momo">  Momo
      </label>
      <label class="payment-option">
        <input type="radio" name="payment" value="vnpay"> VnPay
      </label>
      <label class="payment-option">
        <input type="radio" name="payment" value="bank"> Bank Transfer
      </label>
    </div>

    <!-- ========== Order Summary ========== -->
    <div class="checkout-card order-summary">
      <h3>Đơn hàng</h3>

      {% for item in cart.items.all %}
        <div class="summary-row">
          {% if item.product %}
            <span>{{ item.product.name }} (x{{ item.quantity }})</span>
          {% elif item.combo %}
            <span> {{ item.combo.name }} (x{{ item.quantity }})</span>
          {% endif %}
          <span>${{ item.subtotal|floatformat:2 }}</span>
        </div>
      {% empty %}
        <p>Cart is empty</p>
      {% endfor %}


      <hr style="border:none; border-top:1px solid var(--gray); margin:14px 0;">
      <div class="summary-row">
        <span>Tạm tính</span>
        <span>${{ cart.subtotal|floatformat:2 }}</span>
      </div>
      <div class="summary-row">
        <span>Shipping cost</span>
        <span>Free</span>
      </div>

      <!-- Discount code entry box -->
      <hr style="border:none; border-top:1px solid var(--gray); margin:14px 0;">
      <div style="display:flex; gap:10px;">
        <input type="text" name="coupon" placeholder="Enter your code..." 
              value="{{ coupon_code }}" style="flex:1;">
        <button type="submit" class="btn btn-outline" name="applycoupon" value="1">
          Apply
        </button>
      </div>

      {% if discount and discount > 0 %}
      <div class="summary-row" style="color:green; font-weight:600; margin-top:8px;">
        <span>Discount</span>
        <span>-${{ discount|floatformat:2 }}</span>
      </div>
      {% endif %}

      <hr style="border:none; border-top:1px solid var(--gray); margin:14px 0;">
      <div class="summary-row">
        <strong>Total</strong>
        <strong>${{ total_after_discount|floatformat:2 }}</strong>
      </div>

      <button type="submit" class="btn btn-primary btn-checkout" name="placeorder" value="1"
              {% if cart.items.count == 0 %}disabled style="opacity:0.6; cursor:not-allowed;"{% endif %}>
        Place Order
      </button>
    </div>
  </section>
</form>

<script src="{% static 'app/js/checkout.js' %}"></script>
{% endblock %}
