{% extends "app/base.html" %}
{% load static %}

{% block title %}{{ combo.name }} â€“ GreenNest Combo{% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'app/css/detail.css' %}">
<style>
.combo-products {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 20px;
  margin-top: 20px;
}
.combo-product {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  background: #fafafa;
  text-align: center;
}
.combo-product img {
  width: 100%;
  height: 160px;
  object-fit: cover;
  border-radius: 6px;
}
</style>

<section class="container detail-wrapper">
  <!-- Images and inf combo -->
  <div class="detail-img">
    <div class="slider">
      {% if combo.image %}
        <div class="slide active">
          <img src="{{ combo.image.url }}" alt="{{ combo.name }}">
        </div>
      {% else %}
        <div class="slide active">
          <img src="{% static 'app/images/default_combo.jpg' %}" alt="{{ combo.name }}">
        </div>
      {% endif %}
    </div>
  </div>

  <div class="detail-info">
    <h1>{{ combo.name }}</h1>

    <div class="price">
      <strong style="font-size:24px; color:var(--green);">
        ${{ combo.final_price|floatformat:2 }}
      </strong>
      <span style="text-decoration:line-through; color:gray; font-size:16px;">
        ${{ combo.original_price|floatformat:2 }}
      </span>
      <p style="color:#888; margin-top:4px;"></p>
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="desc">Description</button>
      <button class="tab-btn" data-tab="products">Products in combo</button>
    </div>

    <div class="tab-content active" id="desc">
      <p>{{ combo.description|default:"There is no description for this combo yet." }}</p>

      <form method="post" action="{% url 'add_combo_to_cart' combo.id %}" style="margin-top:16px;">
        {% csrf_token %}
        <div class="add" style="align-items:center; gap:12px;">
          <div class="qty">
            <button type="button" class="qty-decrease">âˆ’</button>
            <span class="qty-display">1</span>
            <button type="button" class="qty-increase">+</button>
          </div>
          <input type="hidden" name="quantity" value="1" class="qty-input">
          <button type="submit" class="btn-primary" style="padding:14px 18px">
            ðŸ›’ Add combo to cart
          </button>
        </div>
      </form>
    </div>

    <div class="tab-content" id="products">
      <div class="combo-products">
        {% for item in combo_items %}
          <div class="combo-product">
            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
            <div>
              <h4>{{ item.product.name }}</h4>
              <p>Quantity: {{ item.quantity }}</p>
              <p>Price: ${{ item.product.price|floatformat:2 }}</p>
            </div>
          </div>
        {% empty %}
          <p class="subtle">This combo currently has no products.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<!-- Other Combos -->
<section class="container related">
  <h2>Other Combos </h2>
  <div class="grid">
    {% for cb in related_combos %}
      <article class="card">
        <a href="{% url 'combodetail' cb.id %}" style="text-decoration:none; color:inherit;">
          <div class="thumb">
            {% if cb.image %}
              <img src="{{ cb.image.url }}" alt="{{ cb.name }}" style="width:100%; height:180px; object-fit:cover;">
            {% endif %}
          </div>
          <div class="content">
            <h3 style="margin:8px 0 6px">{{ cb.name }}</h3>
            <p class="subtle">{{ cb.description|truncatewords:12 }}</p>
          </div>
        </a>
      </article>
    {% empty %}
      <p class="subtle">No combo involved.</p>
    {% endfor %}
  </div>
</section>

<script src="{% static 'app/js/detail.js' %}"></script>


{% endblock %}
