{% extends "app/base.html" %}
{% load static %}

{% block title %}{{ combo.name }} ‚Äì GreenNest Combo{% endblock %}

{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="https://cdn.lineicons.com/4.0/lineicons.css">
    <!-- Google Fonts - Montserrat -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
<link rel="stylesheet" href="{% static 'app/css/productdetail.css' %}"> 
<link rel="stylesheet" href="{% static 'app/css/product_card.css' %}"> 
<link rel="stylesheet" href="{% static 'app/css/neo-brutalism-global.css' %}"> 

<main> 
<!-- Breadcrumb --> 
<div class="breadcrumb-container"> 
  <div class="breadcrumb"> 
    <a href="{% url 'home' %}">Home</a> 
      <a href="{% url 'productlist' %}">Combo Deals</a>  
        <span>{{ combo.name }}</span> 
      </div> 
    </div> 
<!-- Product Detail Container --> 
<div class="product-detail-container"> 
  <!-- Combo Images --> <div class="product-images"> 
    {% if combo.image %} 
    <img src="{{ combo.image.url }}" alt="{{ combo.name }}" class="main-image"> 
    {% else %} 
    <img src="{% static 'app/images/default_combo.jpg' %}" alt="{{ combo.name }}" class="main-image"> 
    {% endif %} 
    <div class="thumbnail-container"> 
    {% for img in combo.gallery.all %} 
      <img src="{{ img.image.url }}" alt="{{ combo.name }}" class="thumbnail {% if forloop.first %}active{% endif %}"> 
      {% endfor %} 
    </div> 
  </div>

<!-- Combo Info -->
<div class="product-info">
  <div class="product-badges">
    <span class="product-badge badge-new">üî• COMBO DEAL</span>
    {% if combo.discount_percent %}
      <span class="product-badge badge-organic">Save {{ combo.discount_percent }}%</span>
    {% endif %}
  </div>

  <h1 class="product-title">{{ combo.name }}</h1>

  <div class="product-meta">
    <span><i class="fas fa-box"></i> {{ combo_items.count }} Items</span>
    {% if combo.serves %}
      <span><i class="far fa-clock"></i> Serves {{ combo.serves }}</span>
    {% endif %}
    <span><i class="fas fa-leaf"></i> 100% Organic</span>
  </div>

  <div class="price-section">
    <span class="current-price">${{ combo.final_price|floatformat:2 }}</span>
    {% if combo.original_price %}
      <span class="original-price">${{ combo.original_price|floatformat:2 }}</span>
    {% endif %}
    {% if combo.discount_amount %}
      <span class="discount-badge">SAVE ${{ combo.discount_amount|floatformat:0 }}</span>
    {% endif %}
  </div>

  <p class="product-description">{{ combo.description|safe }}</p>

  <div class="nutrition-highlights">
    <h3>‚ú® What's Included in This Combo</h3>
    <div class="nutrition-icons">
      {% for item in combo_items %}
        <div class="nutrition-item">
          <i class="fas fa-check-circle"></i>
          <span>{{ item.product.name }}</span>
        </div>
      {% empty %}
        <p>No products included in this combo yet.</p>
      {% endfor %}
    </div>
  </div>

  <!-- Add to Cart -->
  <form method="post" action="{% url 'add_combo_to_cart' combo.id %}">
    {% csrf_token %}
    <div class="product-actions">
      <button type="submit" class="add-to-cart">
        <i class="fas fa-shopping-cart"></i> Add Combo to Cart
      </button>
    </div>
  </form>
</div>
</div> 
<!-- Combo Included Products --> 
<div class="related-products" style="margin-top: 60px;"> 
  <h2 class="related-title">What's Inside This Combo</h2> 
    <div class="related-grid"> 
    {% for item in combo_items %} 
    <a href="{% url 'productdetail' item.product.id %}" class="product-card"> 
      <div class="card-image"> 
        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="product-img"> 
      </div> 
      <div class="card-info"> 
        <h3 class="product-name">{{ item.product.name }}</h3> 
          <div class="product-nutrients"> {% if item.product.prep_time %} 
            <span class="nutrient">{{ item.product.prep_time }} min</span> 
            {% endif %} {% if item.product.calories %} 
            <span class="nutrient">{{ item.product.calories }} cal</span> 
            {% endif %} 
          </div> 
          <button class="btn-add-cart"> 
            <span class="btn-text">${{ item.product.price|floatformat:2 }}</span> 
              <span class="btn-price">(Included)</span> 
          </button> 
        </div>  
    </a> 
    {% empty %} 
    <p>No items found in this combo.</p> 
    {% endfor %} 
    </div> 
  </div> 
  <!-- Benefits Section --> 
  <div class="tab-content" id="benefits"> 
    <div style="max-width: 800px; margin: 0 auto;"> 
      <div class="step" style="border: 3px solid var(--primary-color); background: #E8F5E9;"> 
        <div class="step-number" style="background: var(--primary-color);">üí∞</div> 
          <div class="step-content"> <h3>Save {{ combo.discount_percent }}%</h3> 
            <p>Buying this combo saves you ${{ combo.discount_amount|floatformat:0 }} compared to individual purchases!</p> 
          </div> 
        </div> 
        <div class="step" style="border: 3px solid var(--accent-yellow); background: #FFFACD;"> 
          <div class="step-number" style="background: var(--accent-yellow); color: var(--black);">üçΩÔ∏è</div> 
            <div class="step-content"> <h3>Variety & Convenience</h3> 
              <p>Get all your favorite meals in one convenient package!</p> 
            </div> 
          </div>  
            <div class="step" style="border: 3px solid var(--secondary-color); background: #FFE5DB;"> 
              <div class="step-number" style="background: var(--secondary-color);">üåø</div> 
                <div class="step-content"> <h3>100% Organic Ingredients</h3> 
                  <p>Every item in this combo is made from fresh, organic ingredients.</p> 
                </div> 
              </div> 
            </div> 
          </div> 
        <!-- Related Combos --> 
        <div class="related-products"> 
          <h2 class="related-title">Other Popular Combos</h2> 
            <div class="related-grid"> 
            {% for cb in related_combos %} 
              <div class="product-card"> <div class="card-image"> 
                    <img src="{{ cb.image.url }}" alt="{{ cb.name }}" class="product-img"> </div> 
                      <div class="card-info"> 
                      <h3 class="product-name">{{ cb.name }}</h3> 
                        <div class="product-nutrients"> <span class="nutrient">{{ cb.items.count }} Items</span> 
                        {% if cb.serves %} 
                        <span class="nutrient">Serves {{ cb.serves }}</span> 
                        {% endif %} 
                      </div> 
                        <button class="btn-add-cart"> 
                          <span class="btn-text">${{ cb.final_price|floatformat:2 }}</span> 
                            <span class="btn-price"><del>${{ cb.original_price|floatformat:2 }}</del>
                          </span> 
                        </button> 
                    </div> 
                </div> 
                {% empty %} 
                <p>No other combos available.</p> 
                {% endfor %} 
                </div> 
              </div> 
            </main> 
<script src="{% static 'app/js/productdetail.js' %}"></script>
{% endblock %}